<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Demo ERforResearch â€¢ ERforResearch</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Demo ERforResearch">
<meta property="og:description" content="ERforResearch">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ERforResearch</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.1.0.9006</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ERforResearch_vignette.html">Demo ERforResearch</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="ERforResearch_vignette_files/header-attrs-2.6/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Demo ERforResearch</h1>
                        <h4 class="author">R. Heyard</h4>
            
      
      
      <div class="hidden name"><code>ERforResearch_vignette.Rmd</code></div>

    </div>

    
    
<p>The complex methodology of the ER is rather straightforward to use, even without knowledge in building Bayesian hierarchical models. First, for illustration, we will load a mock data set in <code>R</code>. The function <code><a href="../reference/get_mock_data.html">get_mock_data()</a></code> does exactly that.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load the mock data</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_mock_data.html">get_mock_data</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>The dataset comprises 3 different panels, with 5 voter and 15 proposals each. Every one of these voters gives a score to each of the proposals. For the first illustrations, we will only use one panel (<code>p1</code>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_panel1</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">panel</span> <span class="op">==</span> <span class="st">"p1"</span><span class="op">)</span></code></pre></div>
<p>The aim of this package is to be able to rank the proposals in a certain call or panel. The most straightforward way to do this, is to use the average of the scores a proposal received from all the voters:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># First ranking based on simple means: </span>
<span class="va">data_panel1</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">application</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarise</span><span class="op">(</span>avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">num_grade</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">arrange</span><span class="op">(</span><span class="op">-</span><span class="va">avg</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 15 x 2
##    application   avg
##    &lt;chr&gt;       &lt;dbl&gt;
##  1 #1            5  
##  2 #2            4.6
##  3 #3            4.6
##  4 #4            4.6
##  5 #5            4.4
##  6 #6            4.2
##  7 #7            4  
##  8 #8            4  
##  9 #9            3.8
## 10 #10           3.6
## 11 #11           3.4
## 12 #12           3.2
## 13 #13           2.8
## 14 #14           2.8
## 15 #15           2.6</code></pre>
<p>Let us assume, we had funding to accept five proposals in panel 1. In this case, we would accept and fund the proposals #1-5, with average scores ranging from 5 to 4.4. The methodology in the <code>ERforResearch</code> package allows us to incorporate the information on the voters behavior (are they more or less strict in giving grades to proposals?). Additionally to that, the Bayesian hierarchical models (BHM) can incorporate random variation in the grading of the proposals, for example, due to conflict of interests or other one proposal is not grades by every voter, (Note that here no voter had a COI). This happens very regularly in the grant peer review process. For this reason we will use a JAGS model via the <code>rjags</code> package to build such a flexible model. The <code>ERforResearch</code> package includes a function to call a default JAGS BHM model:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ERforResearch</span><span class="fu">::</span><span class="va"><a href="../reference/get_default_jags_model.html">get_default_jags_model</a></span></code></pre></div>
<pre><code>## function(path = "default_jags_model.txt") {
##   cat("model{
##       # Likelihood:
##       for (i in 1:n) { # i is not the application but the review
##           grade[i] ~ dnorm(mu[i], inv_sigma2)
##                 # inv_sigma2 is precision (1 / variance)
##           mu[i] &lt;- overall_mean + application_intercept[num_application[i]] +
##           voter_intercept[num_application[i], num_voter[i]]
##           }
##       # Ranks: (for the expected ranks)
##       rank_theta[1:n_application] &lt;- rank(-application_intercept[])
##       # Priors:
##       for (j in 1:n_application){
##         application_intercept[j] ~ dnorm(0, inv_tau_application2)
##       }
##       for (l in 1:n_voters){
##         for(j in 1:n_application){
##           voter_intercept[j, l] ~ dnorm(nu[l], inv_tau_voter2)
##         }
##       }
##       for (l in 1:n_voters){
##         nu[l] ~ dnorm(0, 4) # 1/(0.5^2) = 4
##       }
##       sigma ~ dunif(0.000001, 2)
##       inv_sigma2 &lt;- pow(sigma, -2)
##       inv_tau_application2 &lt;- pow(tau_application, -2)
##       tau_application ~ dunif(0.000001, 2)
##       inv_tau_voter2 &lt;- pow(tau_voter, -2)
##       tau_voter ~ dunif(0.000001, 2)
##       }",
##       file = here(path))
## }
## &lt;bytecode: 0x00000000126b3f68&gt;
## &lt;environment: namespace:ERforResearch&gt;</code></pre>
<p>Then, we have the possibility to simply use that default model and sample from it using the <code><a href="../reference/get_mcmc_samples.html">get_mcmc_samples()</a></code> function.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Estimate theta's </span>

<span class="va">mcmc_samples_object</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/get_mcmc_samples.html">get_mcmc_samples</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">data_panel1</span>, id_application <span class="op">=</span> <span class="st">"application"</span>, id_voter <span class="op">=</span> <span class="st">"voter"</span>,
    grade_variable <span class="op">=</span> <span class="st">"num_grade"</span>,
    path_to_jags_model <span class="op">=</span> <span class="cn">NULL</span>, 
          <span class="co"># NULL means we use the default model</span>
    n_chains <span class="op">=</span> <span class="fl">3</span>, n_iter <span class="op">=</span> <span class="fl">5000</span>, n_burnin <span class="op">=</span> <span class="fl">1000</span>, 
    seed <span class="op">=</span> <span class="fl">6</span>, dont_bind <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Default model is used (check get_default_jags_model function!)."</code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># With the latter object we can do some convergence diagnostics, as for example</span>
<span class="co"># gelman.diag(mcmc_samples_object)</span>
<span class="co"># and</span>
<span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-traces.html">mcmc_trace</a></span><span class="op">(</span><span class="va">mcmc_samples_object</span>,
                      pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"application_intercept["</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">15</span>, <span class="st">"]"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="ERforResearch_vignette_files/figure-html/unnamed-chunk-3-1.png" alt="Traceplots of the proposal effects." width="672"><p class="caption">
Traceplots of the proposal effects.
</p>
</div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># If the model in path_to_jags_model is different from the default model with</span>
<span class="co"># different names for the specific parameters, this has to be declared in the </span>
<span class="co"># arguments (theta_name, tau_name, sigma_name, tau_voter_name, rank_theta_name,</span>
<span class="co"># other_variables).</span>

<span class="co"># For the further analyis we will simply use all three chains</span>
<span class="co"># and therefore bind them here.</span>
<span class="va">mcmc_samples</span> <span class="op">&lt;-</span> <span class="fu">mcmc</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">mcmc_samples_object</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We do not have to separately sample from the model, as the functions that follow can easily call the <code><a href="../reference/get_mcmc_samples.html">get_mcmc_samples()</a></code> themselves. If the same seed is given to the <code>seed</code> argument in the respective functions the results are reproducible.</p>
<p>Then, we use the <code><a href="../reference/plot_rankogram.html">plot_rankogram()</a></code> function to plot the <em>Rankograms</em> of each proposal, which are the probabilities of each rank plotted against all possible ranks.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_rankogram.html">plot_rankogram</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_panel1</span>,
               id_application <span class="op">=</span> <span class="st">"application"</span>,
               id_voter <span class="op">=</span> <span class="st">"voter"</span>,
               grade_variable <span class="op">=</span> <span class="st">"num_grade"</span>,
               mcmc_samples <span class="op">=</span> <span class="va">mcmc_samples</span>
                  <span class="co"># if NULL the `get_mcmc_samples function is called from within</span>
<span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="ERforResearch_vignette_files/figure-html/produce-rankogram-1.png" alt="Rankogram for the proposals on the first panel." width="672"><p class="caption">
Rankogram for the proposals on the first panel.
</p>
</div>
<p>Next, we can use the same function with the parameter <code>cumulative_rank_prob</code> set to TRUE in order to plot the cumulative ranking probabilities against the possible ranks.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_rankogram.html">plot_rankogram</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_panel1</span>,
               id_application <span class="op">=</span> <span class="st">"application"</span>,
               id_voter <span class="op">=</span> <span class="st">"voter"</span>,
               grade_variable <span class="op">=</span> <span class="st">"num_grade"</span>,
               cumulative_rank_prob <span class="op">=</span> <span class="cn">TRUE</span>,
               mcmc_samples <span class="op">=</span> <span class="va">mcmc_samples</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="ERforResearch_vignette_files/figure-html/produce-cumulative-ranking-probabilities-1.png" alt="Cumulative ranking probability plots for competing proposals in the first panel." width="672"><p class="caption">
Cumulative ranking probability plots for competing proposals in the first panel.
</p>
</div>
<p>The SUCRA is the area under the cumulative ranking probability plot. The higher the SUCRA value, the higher the likelihood of a proposal being in the top rank or one of the top ranks.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SUCRA_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_sucra.html">get_sucra</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_panel1</span>,
                           id_application <span class="op">=</span> <span class="st">"application"</span>,
                           id_voter <span class="op">=</span> <span class="st">"voter"</span>,
                           grade_variable <span class="op">=</span> <span class="st">"num_grade"</span>,
                           mcmc_samples <span class="op">=</span> <span class="va">mcmc_samples</span><span class="op">)</span>
<span class="va">SUCRA_results</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<pre><code>##   #1   #2   #3   #4   #5   #6   #7   #8   #9  #10  #11  #12  #13  #14  #15 
## 0.90 0.78 0.78 0.78 0.73 0.63 0.55 0.55 0.45 0.40 0.32 0.25 0.15 0.13 0.09</code></pre>
<p>Finally we will compute the expected ranks (ER), which can directly be linked to the SUCRA. The lower the ER the better the evaluation of the proposal. The best possible ER is 1 for rank 1.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ER_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_er_from_jags.html">get_er_from_jags</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_panel1</span>,
                               id_application <span class="op">=</span> <span class="st">"application"</span>,
                               id_voter <span class="op">=</span> <span class="st">"voter"</span>,
                               grade_variable <span class="op">=</span> <span class="st">"num_grade"</span>,
                               mcmc_samples <span class="op">=</span> <span class="va">mcmc_samples</span><span class="op">)</span>

<span class="va">ER_results</span><span class="op">$</span><span class="va">rankings</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate_if</span><span class="op">(</span><span class="va">is.numeric</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">arrange</span><span class="op">(</span><span class="va">er</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 15 x 6
##    id_application  rank rank_pm    er avg_grade  pcer
##    &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;
##  1 #1               1         1  2.41       5    12.7
##  2 #3               3         2  4.04       4.6  23.6
##  3 #2               3         4  4.07       4.6  23.8
##  4 #4               3         3  4.07       4.6  23.8
##  5 #5               5         5  4.72       4.4  28.1
##  6 #6               6         6  6.15       4.2  37.7
##  7 #8               7.5       8  7.3        4    45.3
##  8 #7               7.5       7  7.31       4    45.4
##  9 #9               9         9  8.67       3.8  54.4
## 10 #10             10        10  9.35       3.6  59  
## 11 #11             11        11 10.6        3.4  67.2
## 12 #12             12        12 11.5        3.2  73.6
## 13 #13             13.5      13 12.8        2.8  82.2
## 14 #14             13.5      14 13.2        2.8  84.4
## 15 #15             15        15 13.8        2.6  88.6</code></pre>
<p>The latter, can also be plotted using the <code>plotting_er_results</code> function. As can be seen in the figure, the five best proposals are still the same, but the ordering of all proposals changed. The ER actually does a comparative ranking, by comparing every proposal to every other proposal.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotting_er_results.html">plotting_er_results</a></span><span class="op">(</span><span class="va">ER_results</span>, title <span class="op">=</span> <span class="st">"Panel 1"</span>, how_many_fundable <span class="op">=</span> <span class="fl">5</span>,
                    draw_funding_line <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<div class="figure" style="text-align: center">
<img src="ERforResearch_vignette_files/figure-html/er-plot-1.png" alt="All proposals from the first mock panel ranked using the average grade (Fixed), the posterior means (Posterior Mean) and the expected rank (ER)." width="672"><p class="caption">
All proposals from the first mock panel ranked using the average grade (Fixed), the posterior means (Posterior Mean) and the expected rank (ER).
</p>
</div>
<p>To better see, whether the funding line (FL) (here: between the fifth and the sixth proposal) goes through a cluster, we use the posterior distribution of the ER. The ERs of the competing proposals are plotted together with their 50% credible intervals (CrI). A provisional FL is defined at the ER of the last fundable (here the fifth) proposal. The proposals with a 50% CrI not crossing the FL are directly accecpted or rejected, depending whether their ER is lower or higher than the FL. The proposals with a 50% CrI crossing the FL will constitute the random selection group. In the case of panel 1 of the mock data four proposals will be randomly selected from a group of five.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_er_distributions.html">plot_er_distributions</a></span><span class="op">(</span><span class="va">mcmc_samples</span>, 
                      n_proposals <span class="op">=</span> <span class="va">data_panel1</span> <span class="op">%&gt;%</span>
                        <span class="fu">summarise</span><span class="op">(</span>n <span class="op">=</span> <span class="fu">n_distinct</span><span class="op">(</span><span class="va">application</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="op">)</span>, 
                      number_fundable <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="ERforResearch_vignette_files/figure-html/clustered-er-plot-1.png" alt="All proposals from the first mock panel ranked by their ER together with their 50% credible intervals (inner band) and 90% credible intervals (outer band)." width="672"><p class="caption">
All proposals from the first mock panel ranked by their ER together with their 50% credible intervals (inner band) and 90% credible intervals (outer band).
</p>
</div>
<p>The flexibility of the method of the ER allows us to not only look at the panels individually but also rank all the proposals from the three panels in one large ranking. To do this, we cannot use the default model but have to rewrite it a bit. A .txt version of the following model definition has to be saved:</p>
<pre><code>## model{
##       # Likelihood:
##       for (i in 1:n) { # i is not the application but the review
##           grade[i] ~ dnorm(mu[i], inv_sigma2)
##                 # inv_sigma2 is precision (1 / variance)
##           mu[i] &lt;- overall_mean + application_intercept[num_application[i]] +
##           voter_intercept[num_voter[i]] + section_intercept[num_section[i]]
##       }
##       # Ranks:
##       rank_theta[1:n_application] &lt;- rank(-application_intercept[])
##       # Priors:
##       for (j in 1:n_application){
##         application_intercept[j] ~ dnorm(0, inv_tau_application2)
##       }
##       for (l in 1:n_voters){
##         voter_intercept[l] ~ dnorm(nu[l], inv_tau_voter2)
##       }
##       for (l in 1:n_voters){
##         nu[l] ~ dnorm(0, 100) # 1/(0.1^2) = 100
##       }
##       for (l in 1:n_section){
##         section_intercept[l] ~ dnorm(0, inv_tau_section2)
##       }
##       sigma ~ dunif(0.000001, 2)
##       inv_sigma2 &lt;- pow(sigma, -2)
##       inv_tau_application2 &lt;- pow(tau_application, -2)
##       tau_application ~ dunif(0.000001, 2)
##       inv_tau_voter2 &lt;- pow(tau_voter, -2)
##       tau_voter ~ dunif(0.000001, 2)
##       inv_tau_section2 &lt;- pow(tau_section, -2)
##       tau_section ~ dunif(0.000001, 2)
##     }</code></pre>
<p>Then we use the latter model to directly plot the ER:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ER_results_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_er_from_jags.html">get_er_from_jags</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>,
                                   id_application <span class="op">=</span> <span class="st">"application"</span>,
                                   id_voter <span class="op">=</span> <span class="st">"voter"</span>,
                                   id_section <span class="op">=</span> <span class="st">"panel"</span>,
                                   grade_variable <span class="op">=</span> <span class="st">"num_grade"</span>,
                                   path_to_jags_model <span class="op">=</span> 
                                     <span class="fu">here</span><span class="op">(</span><span class="st">"jags_model_with_sections.txt"</span><span class="op">)</span>,
                                   tau_section_name <span class="op">=</span> <span class="st">"tau_section"</span>,
                                   n_chains <span class="op">=</span> <span class="fl">3</span>, n_iter <span class="op">=</span> <span class="fl">5000</span>,
                                   n_burnin <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>

<span class="fu"><a href="../reference/plotting_er_results.html">plotting_er_results</a></span><span class="op">(</span><span class="va">ER_results_all</span>, title <span class="op">=</span> <span class="st">"All three panels"</span>,
                    draw_funding_line <span class="op">=</span> <span class="cn">FALSE</span>, how_many_fundable <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>  </code></pre></div>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<div class="figure" style="text-align: center">
<img src="ERforResearch_vignette_files/figure-html/er-plot-all-1.png" alt="The proposals from all mock panels ranked using the average grade (Fixed), the posterior means (Posterior Mean) and the expected rank (ER)." width="672"><p class="caption">
The proposals from all mock panels ranked using the average grade (Fixed), the posterior means (Posterior Mean) and the expected rank (ER).
</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Rachel Heyard.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
